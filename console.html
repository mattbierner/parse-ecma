---
layout: base
---
<div id='console-input'>
    <h1>Input</h2>
    <div class='group'>
        <div id='console-parser'>
            <div>
                <h4>Parser</h4>
                <textarea rows='6' placeholder="Parser to run. Has access to to 'parse' and 'parse.string'. i.g. parse_string.character('a')"></textarea>
            </div>
        </div>
        <div id='console-text'>
            <div>
                <h4>Text</h4>
                <textarea rows='6' placeholder="Text to run the parser against"></textarea>
            </div>
        </div>
    </div>
    <div>
        <button>Parse</button>
    </div>
</div>

<div class='console-output'>
    <h1>Output</h1>
    <span>Automatically flattens streams</span>
    <div>
        <pre class='ParseError'></pre>
        <pre style='display: none;' class='ParseOut'></pre>
    </div>
</div>


<script type="application/javascript" src="javascripts/require.js"></script>
<script src="javascripts/jquery-1.8.3.min.js"></script>
<script type="application/javascript">
    requirejs.config({
        paths: {
            parse: 'lib',
            nu: 'dependencies/nu/lib'
        }
    });
    
    $(function(){
        require(['parse/parse', 'parse/parse_string', 'nu/stream'],
        function(parse, parse_string, stream) {
            var flatten = function(s, c) {
                if (stream.isStream(s)) {
                    stream.forEach(s, function(x) { flatten(x, c); });
                } else {
                    c(s);
                }
            };
        
            $('button').click(function() {
                $('.ParseOut').children().remove();
                $('.ParseOut').text('');
                $('.ParseError').text('');
                
                try {
                    var parser = eval($('#console-parser textarea').val());
                    var input = $('#console-text textarea').val();
                
                    var out = parse.run(parser, input);
                    flatten(out, function(x) {
                        $('.ParseOut').append(x);
                    });
                    $('.ParseOut').show();
                    $('.ParseError').hide();
                } catch (e) {
                    $('.ParseError').show().text(e);
                    $('.ParseOut').hide();
                }
            });
        });
    });
</script>
